{literal}
<script type="text/javascript">


    $(document).ready(function() {

        /********* TIP 各种弹 ***********/
        var tip = $("#tip-message").HYQTip();

        /***********************************
         红名片的脚本开始
         ************************************/

        var rcEditBox = $("#redcard-edit-box");
        //红名片编辑表单
        var rcReviewBox = $("#redcard-review-box");
        //红名片浏览界面
        var rcEditBtn = $("#redcard-edit-btn");
        //进入红名片编辑状态的按钮
        var rcSaveBtn = $("#redcard-save-btn");
        //保存红名片的按钮
        var rcCancleBtn = $("#redcard-cancle-btn");
        //取消修改

        //点击编辑按钮开始
        rcEditBtn.click(function() {
            $(this).hide();
            rcEditBox.show();
            rcReviewBox.hide();

        });

        //取消保存按钮被触发
        rcCancleBtn.click(function() {

            rcEditBox.hide();
            rcReviewBox.show();
            rcEditBtn.show();
        });

        //保存按钮被触发
		/*
        rcSaveBtn.click(function() {
            //保存红名片的操作在这里整
            //同时因为保存了内容，所以你需要去更新rcReviewBox里面的内容，千万不要忘记了

            //保存成功后的回调里使用这两句切换到浏览模式
            rcEditBox.hide();
            rcReviewBox.show();
            rcEditBtn.show();
        });
		*/
        /***********************************
         红红名片的脚本结束
         ************************************/

        /***********************************
         图片上传的的脚本开始
         ************************************/
        var dlg = $("#img-cropper-dialog");

        var imgCropper = $('.hyq-image-cropper').HYQImageCropper({
            uploadApi : "/home/ajax/ajax_home_userprofile.php?action=upload_icon", //在这里配置上传图片的API
            cropApi : "/home/ajax/ajax_home_userprofile.php?action=head_photo_cut"//在这里配置截图的API
        });

        dlg.on("hyq/modal/hidden", function() {
            imgCropper.trigger('hyq/imagecropper/reset');
        });

        imgCropper.on("hyq/imgcropper/success", function(event) {
            //接受成功信息

            //头像上传成功哦那个后，图片地址是一个数组，
            //保存在  event.images
            // 格式为 ['1：1头像的地址','4：3头像第二张图的地址']
            // 你可以在这里提示上传头像成功，也可以获得图片地址作为其他用途
            console.log(event.images);

            dlg.trigger('hyq/modal/close');
            //关闭
            tip.showSuccess("修改头像成功！");
			//1更换头像
			$('#edit_show_icon').prop('src',event.images[0]+'!150');
			//2
			$('#show_head_icon').prop('src',event.images[0]);
			//3  -----------后加的 更新cookie
			$(document).trigger("hyq/userstate/changed");//后加的 更新cookie
        });

        imgCropper.on("hyq/imagecropper/uiactived", function(event) {
            $("#img-cropper-dialog").trigger('hyq/modal/sizechanged');
        });
        /*** 以下两个时间的触发时机是一样的，第一个是带有状态信息的，可以自己控制报错的方式，第二个 是只有错误信息，使用弹出框报错，根据情况使用*/
        /*************************************************************************************/
        // 一
        imgCropper.on('hyq/imgcropper/upload-error', function(event) {
            //当上传失败时，获得返回状态和信息 错误信息存储在 event.hyqData 中
            console.log(event.hyqData);

        });

        // 二
        imgCropper.on('hyq/imgcropper/error-message', function(event) {
            //接受失败信息
            //只获取错误信息 event.hyqMessage
            //触发报错窗口
            $('#error-message-box').trigger({
                type : 'hyq/modal/show_with_message',
                hyqMessage : event.hyqMessage
            });
        });
        /***********************************
         图片上传 脚本结束
         ************************************/

        /***********************************
         红资料的脚本开始
         ************************************/
        //控制显示的三个CSS类
        var stateWrapper = $('#profile-state-box');
        //通过修改这个容器的CSS类来控制显示

        var sClassReview = 'profile-review';
        //浏览模式
        var sClassEdit = 'profile-edit';
        //编辑模式
        var sClassFistEdit = 'profile-first-edit';
        //第一次编辑模式

        var rpEditBtn = $("#profile-edit-btn");
        //编辑按钮
        var rpExpendBtn = $("#profile-expend-btn");
        //展开按钮
        var rpSaveBtn = $("#profile-save-btn");
        //保存按钮
        var rpCancleBtn = $("#profile-cancle-btn");
        //取消按钮

        //红资料编辑按钮被触发
        rpEditBtn.click(function() {

            //在这里初始化编辑状态下的表单值

            stateWrapper.removeClass(sClassReview).addClass(sClassEdit);
        });

        //红资料退出按钮被按下
        rpCancleBtn.click(function() {
            //不做任何保存直接退出编辑模式
            stateWrapper.removeClass(sClassEdit).addClass(sClassReview);
			if(hide_edit_state == 0){
				rpExpendBtn.show();
				rpEditBtn.hide();
			}else{
				rpExpendBtn.hide();
				rpEditBtn.show();	
			}
        });

        //红资料展开按钮被触发
        rpExpendBtn.click(function() {
            //第一次编辑时展开
            stateWrapper.removeClass(sClassFistEdit).addClass(sClassEdit);
        });

        //保存按钮被触发
		/*
        rpSaveBtn.click(function() {
			alert('sada');
            //在这里上保存的ajax

            //一下应该是在 保存成功的回调里调用的代码
            //切换到浏览模式之前，注意更新浏览模式里面的信息

            //注意如果执行成功的话 使用这句代码 切换到浏览模式
            stateWrapper.removeClass(sClassEdit).addClass(sClassReview);
        });
		*/
	$('#profile-save-btn').click(function(){	
		$("#profile_tips").fadeOut();
		var age = $('#age').val();	
		var height = $('#height').val();	
		var weight = $('#weight').val();	
		var bust = $('#bust').val();	
		var waist = $('#waist').val();	
		var hips = $('#hips').val();	
		var star = $('#star').val();	
		var blood = $('#blood').val();	
		var native_province_id = $('#native_province').val();	
		var native_city_id = $('#native_city').val();	
		var native_district_id = $('#native_area').val();	
		var school = $('#school').val();	
		var finish_year = $('#finish_year').val();	
		var specialty = $('#specialty').val();
		var degree = $('#degree').val();	
		var in_org = $('#in_org').val();	
		if((school.length > 30)){	
			$("#profile_tips label").text('毕业院校字数超了!');			
			$("#profile_tips").fadeIn();	
			return;
		}
		if((specialty.length > 30)){	
			$("#profile_tips label").text('专业字数超了!');			
			$("#profile_tips").fadeIn();
			return;		
		}
		if((in_org.length > 30)){	
			$("#profile_tips label").text('所属机构字数超了!');			
			$("#profile_tips").fadeIn();	
			return;			
		}				
		var action = 'update_user_profile';		
		$.post("/home/ajax/ajax_home_userprofile.php",{'action':action,
																'age':age,
																'height':height,
																'weight':weight,
																'bust':bust,
																'waist':waist,
																'hips':hips,
																'star':star,
																'blood':blood,
																'native_province_id':native_province_id,
																'native_city_id':native_city_id,
																'native_district_id':native_district_id,
																'school':school,
																'finish_year':finish_year,
																'specialty':specialty,
																'degree':degree,
																'in_org':in_org								
			},function(data){
			//alert(data);
			if(parseInt(data) == 1000){
				var stateWrapper = $('#profile-state-box');
				//通过修改这个容器的CSS类来控制显示
				var sClassReview = 'profile-review';
				//浏览模式
				var sClassEdit = 'profile-edit';	
				stateWrapper.removeClass(sClassEdit).addClass(sClassReview);			
				var start_native_province = $("#native_province").next().find('span').text();
				var start_native_city = $("#native_city").next().find('span').text();
				var start_native_area = $("#native_area").next().find('span').text();
				if(start_native_province == '所在省'){start_native_province ='';}
				if(start_native_city == '所在市'){start_native_city ='';}
				if(start_native_area == '所在区'){start_native_area ='';}
				if(age==0){age = '';}
				if(height==0){height = '';}
				if(weight==0){weight = '';}
				if(bust==0){bust = '';}
				if(waist==0){waist = '';}
				if(hips==0){hips = '';}	
				if(finish_year==0){finish_year = '';}	
{/literal}		console.log(star);			
				if(age=={$AGE_RANGE.max}){
					age='{$AGE_RANGE.end}及以上';
				}else if(age=={$AGE_RANGE.min}){
					age='{$AGE_RANGE.begin-1}及以下';
				}else{
					age =age;
				}
				if(height=={$HEIGHT_RANGE.min}){
					height = '{$HEIGHT_RANGE.begin-1}及以下';
				}else if(height=={$HEIGHT_RANGE.max}){
					height = '{$HEIGHT_RANGE.end}及以上';
				}else{
					height = height;
				}
				if(weight=={$WEIGHT_RANGE.min}){
					weight = '{$WEIGHT_RANGE.begin-1}及以下';
				}else if(weight=={$WEIGHT_RANGE.max}){
					weight = '{$WEIGHT_RANGE.end}及以上';
				}else{
					weight = weight;
				}
                if(bust=={$BUST_RANGE.min}){
                    bust = '{$BUST_RANGE.begin-1}CM及以下';
                }else if(bust=={$WEIGHT_RANGE.max}){
                    bust = '{$BUST_RANGE.end}CM及以上';
                }else{
                    bust = bust+'CM';
                }
                if(waist=={$WAIST_RANGE.min}){
                    waist = '{$WAIST_RANGE.begin-1}CM及以下';
                }else if(waist=={$WAIST_RANGE.max}){
                    waist = '{$WAIST_RANGE.end}CM及以上';
                }else{
                    waist = waist+'CM';
                }
                if(hips=={$HIPS_RANGE.min}){
                    hips = '{$HIPS_RANGE.begin-1}CM及以下';
                }else if(hips=={$HIPS_RANGE.max}){
                    hips = '{$HIPS_RANGE.end}CM及以上';
                }else{
                    hips = hips+'CM';
                }   
{literal}				
				var profile_one = "<label>年龄：</label><span>"+age+"</span><i>|</i><label>身高：</label><span>"+height+"</span><i>|</i><label>体重：</label><span>"+weight+"</span>";
				var profile_two = "<label>三围：</label><span>"+bust+"-"+waist+"-"+hips+"</span>";
				var profile_three = "<label>星座：</label><span>"+star+"</span><i>|</i><label>血型：</label><span>"+blood+"型</span>";
				var profile_four = "<label>籍贯：</label><span>"+start_native_province+start_native_city+start_native_area+"";
				var profile_five = "<label>毕业学校：</label><span>"+school+"</span><i>|</i><label>专业：</label><span>"+specialty+"</span>";
				var profile_six = "<label>毕业年份：</label><span>"+finish_year+"年</span><i>|</i><label>最高学历：</label><span>"+degree+"</span>";
				var profile_seven ="<label>所属机构：</label><span>"+in_org+"</span>";
				if((age=='岁')&&(height=='cm')&&(weight=='kg')){
					$("#profile_one").empty().html();	
				}else{
					$("#profile_one").empty().html(profile_one);			
				}
				if((bust=='')&&(waist=='')&&(hips=='')){
					$("#profile_two").empty().html();
				}else{
					$("#profile_two").empty().html(profile_two);	
				}
				if((star=='')&&(blood=='')){
					$("#profile_three").html();		
				}else{
					$("#profile_three").html(profile_three);	
				}		
				if((start_native_province==''||start_native_province=='所在省')&&(start_native_city==''||start_native_city=='所在市')&&(start_native_area==''||start_native_area=='所在区')){
					$("#profile_four").empty().html();
				}else{
					$("#profile_four").empty().html(profile_four);
				}				
				if((school=='')&&(specialty=='')){
					$("#profile_five").empty().html();		
				}else{
					$("#profile_five").empty().html(profile_five);	
				}					
				if((finish_year=='')&&(degree=='')){
					$("#profile_six").empty().html();		
				}else{					
					$("#profile_six").empty().html(profile_six);		
				}	
				if(in_org==''){
					$("#profile_seven").empty().html();						
				}else{
					$("#profile_seven").empty().html(profile_seven);						
				}	
			}else if(parseInt(data) == 1165){
				$("#profile_tips label").text('毕业院校字数超了!');			
				$("#profile_tips").fadeIn();
				return;	
			}else if(parseInt(data) == 1166){
				$("#profile_tips label").text('专业字数超了!');			
				$("#profile_tips").fadeIn();
				return;				
			}else if(parseInt(data) == 1167){	
				$("#profile_tips label").text('所属机构字数超了!');			
				$("#profile_tips").fadeIn();		
				return;				
			}else{
				$("#profile_tips label").text('修改失败!');			
				$("#profile_tips").fadeIn();		
			}
			$(document).trigger("hyq/userstate/changed");//如果cookie改动触发这个事件  实时更新
		},'text')
		
	});			
        /***********************************
         红资料的脚本结束
         ************************************/

        /***********************************
         红相册开始
         ************************************/
        
        //初始化的数据===============================  
        /*var _album = [{
            id : "1",
            thumbnail : "http://icon.hotyq.com/v2/photo.jpg",
            photo : "http://icon.hotyq.com/v2/photo.jpg"

        }, {
            id : "2",
            thumbnail : "http://icon.hotyq.com/v2/photo.jpg",
            photo : "http://icon.hotyq.com/v2/photo.jpg"
        },
        null,
        null,
        null,
        null];*/
{/literal}
        var _album = {$album_list};
{literal}
        //==============================================


        $("#album-data-store").HYQAlbumDatastore({
            albumData:_album,///上面电议的原始数据，可以在页面载入的时候用PHP打印
            deleteApi:"/home/ajax/ajax_home_userprofile.php?action=delete_album_photo",//删除数据的API
            delRequstFieldName:'photo_id_arr',//$_REQUEST获取参数时的KEY 默认是photo_id_arr 可以根据自己的需要修改
        });

        var albumStore = $("#album-data-store").data('ui-HYQAlbumDatastore');
        

        var manager = $(".album-manager");
        $('.album-manager').HYQAlbumManager({
            uploadApi : "/home/ajax/ajax_home_userprofile.php?action=upload_album_photo", //是相册上传的API
            fileField : "img", //这个是你希望给你提交上传文件的时候给你传的那个参数名
            albumStore : albumStore
        });

        manager.on('hyq/album_manager/show_photo', function(event) {
            //打开图片浏览器
            console.log("HERE")
            console.log(event.photoId);
            $("#img-album-viewport-dialog").trigger('hyq/modal/show');
            console.log("HERE")
        });

        manager.on("hyq/album_manager/cropper_avatar", function(event) {
            console.log("页面主逻辑街道图像管理器发来截图请求：");
            console.log(event);
            var imgCropperInstance = imgCropper.data('ui-HYQImageCropper');
            $("#img-cropper-dialog").trigger('hyq/modal/show');
            imgCropperInstance.cropWithExistImage(event.imageUrl);
        });
		var managerInstance = manager.data('ui-HYQAlbumManager');
        //开始处理图片查看器
        var viewport = $("#user-profile-album-viewport");
        viewport.HYQAlbumViewport({
            albumStore :albumStore,
            activePos : null,
            //manager:manager
            manager:managerInstance
        });
        var viewportInstance = viewport.data("ui-HYQAlbumViewport");



        /***********************************
         红相册结束
         ************************************/

        /***********************************
         红标签开始
         ************************************/
        //各种按钮
        var tagSaveBtn = $('#redtags-save-btn');
        var tagCancleBtn = $('#redtags-cancle-btn');
        var tagEditBtn = $('#redtags-edit-btn');
        var tagExpendBtn = $('#redtags-expend-btn');
        //各种盒子
        var tagReviewBox = $('#redtags-review-box');
        var tagEditBox = $('#redtags-edit-box');
        var tagDiyBox = $('#redtags-diys');
        var tagDiyMaker = $("#redtags-diy-maker");
		var tagDiyMaker2 = $(".plus-square-wrap");
        //样式名
        var tgFirstEditCss = "rt-first-edit";
        var tgEditCss = "rt-edit";
        var tgReviewCss = "rt-review";

        //整个栏
        var tgColumn = $("#redtags-column");

        var hide_edit_tags  = $('#hide_edit_tags').val();


        //初始化显示状态状态
        var updateTagMode = function() {
            //第一次编辑模式
            if (tgColumn.hasClass(tgFirstEditCss)) {
                tagReviewBox.hide();
                tagEditBox.hide();
                tagExpendBtn.show();
                tagEditBtn.hide();

            }

            //编辑模式
            if (tgColumn.hasClass(tgEditCss)) {
                tagReviewBox.hide();
                tagEditBox.show();
                tagExpendBtn.hide();
                tagEditBtn.hide();

            }
            //浏览模式
            if (tgColumn.hasClass(tgReviewCss)) {
                tagReviewBox.show();
                tagEditBox.hide();
                tagExpendBtn.hide();
                tagEditBtn.show();

            }
            tgColumn.show();
        };

        var tgSetEditMode = function() {
            tgColumn.removeClass(tgReviewCss).removeClass(tgFirstEditCss).addClass(tgEditCss);
            updateTagMode();
        }
        var tgSetReviewMode = function() {
            tgColumn.addClass(tgReviewCss).removeClass(tgFirstEditCss).removeClass(tgEditCss);
            updateTagMode();
        }
        var tgSetFirstEditMode = function() {
            tgColumn.removeClass(tgReviewCss).addClass(tgFirstEditCss).removeClass(tgEditCss);
            updateTagMode();
        }
        //第一次运行的时候要初始化成什么状态在这里设置
        //********************
        //tgSetFirstEditMode();
        //tgSetReviewMode();
        //tgSetEditMode();

       if(hide_edit_tags == ''){
             tgSetFirstEditMode();
        }else{
            tgSetReviewMode();
        }


        //点击编辑按钮
        tagEditBtn.click(function() {
            tgSetEditMode();
        });

        //展开编辑按钮
        tagExpendBtn.click(function() {
            tgSetEditMode();
        });

        //取消按钮
        tagCancleBtn.click(function() {
             var hide_edit_tags  = $('#hide_edit_tags').val();
           if(hide_edit_tags == ''){
                    tgSetFirstEditMode();
                }else{
                    tgSetReviewMode();
                }
        });

        //保存按钮
        tagSaveBtn.click(function() {
            <!-- 获取用户勾选的标签内容 -->
        var action = 'add_per_tag';
        var love = '';
        $("input[name='mchoice']").each(function(){
            if($(this).prop("checked")){
                love += $(this).val()+'|'; 
            }
        });
        <!-- 获取自定义标签内容 -->
        var self = '';  
        $(".diy-tag-value").each(function(){
			//去除左右空格
            self += $.trim($(this).text())+'|';
			
        }); 

        <!-- ajax传递用户标签 -->
        $.ajax({
            url:'/home/ajax/ajax_home_userprofile.php',
            type:'post',
            data:{'action':action,'love':love,'self':self},
            success:function(data){
                //后台对标签数目的判断
                 if(data == 1310){
                    alert('标签数目超出规定数目!');
                    return;
                 }
                
                 if(data == 1303){              
                    $('.redtags-review-inner').find('label').remove();
                    $('#hide_edit_tags').val('');
                    
                    tgSetFirstEditMode();
                    return;
                 }else{
					$(document).trigger("hyq/userstate/changed");//如果cookie改动触发这个事件  实时更新
                    $('#hide_edit_tags').val('ok');
                    tgSetReviewMode();
                    $(document).trigger("hyq/userstate/changed");//后加的 更新cookie
                 }

                 //无刷新追加显示系统标签 
                $('.redtags-review-inner').find('label').remove();

                $("input[name='mchoice']").each(function(){
                    if($(this).prop("checked")){
                        var sys_tag = $(this).parent().find('label').text();
                        //alert(sys_tag);
                        $('.redtags-review-inner').append('<label class="redtags-review-tag" alt="'+sys_tag+'" title="'+sys_tag+'">'+sys_tag+'</label>');
                    }
                }); 

                $(".diy-tag-value").each(function(){
                    var self_tag = $(this).text();
                    $('.redtags-review-inner').append('<label class="redtags-review-tag" alt="'+self_tag+'" title="'+self_tag+'">'+self_tag+'</label>');
                });
            },
            dataType:'text'
        });          

        });
        
        //删除自定义标签的回调
        var deleteTaghandler = function(event) {
            var tar = event.target || event.srcElement;
            $(tar).parent().remove();
        }
        //检查自定义标签个数
        var checkNumberOfTags = function() {
            if (tagDiyBox.find('.diy-tag').length >= 5) {
                tagDiyMaker.hide();
				tagDiyMaker2.hide();
            } else {
                tagDiyMaker.show();
				tagDiyMaker2.show();
            }
            return tagDiyBox.find('.diy-tag').length;
        }
        //处理自定义标签
        checkNumberOfTags();
        
         
        //在页面载入的时候给已有的tag添加删除时间的绑定
        tagDiyBox.find('.close-btn-tiny').click(function(event) {
            var tar = $(event.target || event.srcElement);
            tar.parent().remove();
            checkNumberOfTags();
        });

        tagDiyMaker.on("keypress", function(evt) {
			//限制自定义标签的内容长度为6个字符
			if($.trim($(this).val()).length >6){
				//alert('自定义标签字符长度不超过六个字符!');
				return false;
			}
            if(checkNumberOfTags()>=5) return;
            if (evt.keyCode == 13) {

                if ($.trim(tagDiyMaker.val()) != "") {
                    var tg = $("<span>").addClass('diy-tag inline-block').html("<span class='diy-tag-value'>" + tagDiyMaker.val() + '</span> &nbsp;&nbsp;<a class="close-btn-tiny"></a>').appendTo(tagDiyBox);
                    tagDiyMaker.val("");
                    tg.find('.close-btn-tiny').click(function(event) {
                        var tar = $(event.target || event.srcElement);
                        tar.parent().remove();

                        checkNumberOfTags();
                    });
  
                }

                checkNumberOfTags();
            } else {
                //不许超过32个字符
                if ($.trim(tagDiyMaker.val()).length >= 32) {
                    return;
                }
            }
        });

		tagDiyMaker2.on("click", function(evt) {
			//alert(1111111);
			//限制自定义标签的内容长度为6个字符
			if($.trim(tagDiyMaker.val()).length >6){
				//alert('自定义标签字符长度不超过六个字符!');
				return false;
			}
            if(checkNumberOfTags()>=5) return;
			//alert(22222);
            //if (evt.keyCode == 13) {
				//alert(3333333);
                if ($.trim(tagDiyMaker.val()) != "") {
                    var tg = $("<span>").addClass('diy-tag inline-block').html("<span class='diy-tag-value'>" + tagDiyMaker.val() + '</span> &nbsp;&nbsp;<a class="close-btn-tiny"></a>').appendTo(tagDiyBox);
                    tagDiyMaker.val("");
                    tg.find('.close-btn-tiny').click(function(event) {
                        var tar = $(event.target || event.srcElement);
                        tar.parent().remove();

                        checkNumberOfTags();
                    });
  
                }

                checkNumberOfTags();
           // } else {
                //不许超过32个字符
               // if ($.trim(tagDiyMaker.val()).length >= 32) {
               //     return;
              //  }
          //  }
        });

         //增补功能 统计系统标签选择数目
             var tagsBox = $("#redtags-edit-box");   
             var fakeCheckboxs = tagsBox.find(".hyq-nice-checkbox+span");
             var realCheckboxs = tagsBox.find(".hyq-nice-checkbox[name=mchoice]");
            //预加载统计系统标签数目
            count_tags();
            fakeCheckboxs.click(function(event){
                    console.log($(this));
                    count_tags();
           }) ;
            function count_tags(){
                    var sysTags = tagsBox.find(".hyq-nice-checkbox[name=mchoice]:checked").length;
                  console.log(sysTags);
                    if(sysTags>=15){
             
                         tagsBox.find(".hyq-nice-checkbox[name=mchoice]:not(:checked)").prop("disabled",true);
                
                     }else{
                
                            tagsBox.find(".hyq-nice-checkbox[name=mchoice]").prop("disabled",false);
                
                        }
            }
        

        /***********************************
         红标签结束
         ************************************/
    }); 
</script>
{/literal}